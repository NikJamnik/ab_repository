import scipy.stats as st


def fishers_exact_p_value(
    a: int,
    b: int,
    c: int,
    d: int,
    alternative: str = 'two-sided'
) -> tuple[float, float]:
    """
    Вычисляет p-value и отношение шансов (odds ratio) по критерию Фишера 
    для 2×2 таблицы сопряжённости.

    Тест Фишера применяется для проверки независимости двух категориальных переменных 
    в таблицах малых размеров (особенно при малых частотах).

    Таблица имеет вид:

                ┌────────────┬────────────┐
                │   success  │   fail     │
                ├────────────┼────────────┤
    test (B)    │     a      │     b      │
    ctrl (A)    │     c      │     d      │
                └────────────┴────────────┘

    где:
        - a — число успехов в тестовой группе,
        - b — число неудач в тестовой группе,
        - c — число успехов в контрольной группе,
        - d — число неудач в контрольной группе.

    Args:
        a (int): Число успехов в тестовой группе.
        b (int): Число неудач в тестовой группе.
        c (int): Число успехов в контрольной группе.
        d (int): Число неудач в контрольной группе.
        alternative (str, optional): Направление альтернативной гипотезы.
            Возможные значения:
                - 'two-sided' (по умолчанию): проверяется равенство вероятностей.
                - 'less': проверяется, что вероятность успеха в первой группе меньше.
                - 'greater': проверяется, что вероятность успеха в первой группе больше.

    Returns:
        tuple[float, float]:
            - p (float): p-value теста Фишера;
            - oddsratio (float): отношение шансов (odds ratio) между группами.
    """
    # Формируем таблицу сопряжённости 2×2
    contingency_table = [[a, b], [c, d]]

    # Вычисляем отношение шансов и p-value по точному критерию Фишера
    oddsratio, p = st.fisher_exact(contingency_table, alternative=alternative)

    return p, oddsratio

